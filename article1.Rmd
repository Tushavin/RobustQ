---
title: "Робастный подход к оценке комплексного показателя качества ИТ-услуг"
author: "Тушавин В. А."
date: "Friday, November 14, 2014"
output:
  html_document:
    keep_md: yes
---
Опубликовано:

*Тушавин В. А. Робастный подход к оценке комплексного показателя качества ИТ-услуг // [Системы управления и информационные технологии](http://www.sbook.ru/suit/suit.htm). 2014. № 4 (58). С. 92–95.*



Целью настоящей статьи является описание подхода к решению задачи оценки комплексного показателя качества с помощью методов стохастического доминирования применительно к оценке качества оказываемых ИТ-услуг. В качестве входных параметров для оценки комплексного показателя качества по предложенной методике использованы данные службы технической поддержки с января 2010 года по октябрь 2014 года (всего 58 измерений). Таблица включает в себя следующие колонки: год (Year), месяц (Month), общее число зарегистрированных обращений (Total), число обращений, выполненных с нарушением срока (Bad), среднее время в секундах от регистрации обращения до приема в работу (Reg time), среднее время работы над обращением в секундах (Work Time), число жалоб (Claim), средняя оценка (Rate). 

### Загрузка данных
```{r}
mydata<-readRDS("datafile.RDS")
dim(mydata)
head(mydata)
summary(mydata)
```

### Функции, которые будут использоваться для анализа

Преобразование шкал с учетом потери качества
```{r}
convert.scale<-function(bad,good,val) {
  x1=bad
  x2=good
  x3=2*good-bad
  y1=0
  y2=1
  y3=0
  a<-(y3-(x3*(y2-y1)+x2*y1-x1*y2)/(x2-x1))/(x3*(x3-x1-x2)+x1*x2)
  b<-(y2-y1)/(x2-x1)-a*(x1+x2)
  c<-(x2*y1-x1*y2)/(x2-x1)+a*x1*x2
  y=a*val*val+b*val+c
  return(ifelse(y>0,y,0))
}

```
Генерация матрицы случайных чисел с заданными ограничениями, равномерно распределенными на ограниченном симплексе с использованием распределение Дирихле
$$  \mathbb{\dot{S}}^m=\{(p_1 \ldots p_m): \sum^m_{i=1}p_i=1;p_i \geqslant 0, i=1, \ldots m; p_a \geqslant p_b, \ldots, p_c \geqslant p_d\} $$

```{r}
set.seed(2014)
library(gtools)
rpoly<-function(n=1, size=2,test=data.frame()) {
  mtx<-rdirichlet(n,rep(1,size))
  if(length(test)==0) return(mtx) 
  for(j in 1:n) {
    while(TRUE) {
     flag=TRUE
      for(i in 1:nrow(test)) {
      if(mtx[j,test$master[i]]<mtx[j,test$slave[i]]) {
        tmp<-mtx[j,test$slave[i]]
        mtx[j,test$slave[i]]<-mtx[j,test$master[i]]
        mtx[j,test$master[i]]<-tmp
        flag=FALSE
      }
    
      }
   if(flag) break
  }
}
return(mtx)
}

```
### Преобразование данных

Создаем новую таблицу для анализа

```{r}
td<-data.frame(YM=as.Date(paste(mydata$Year,mydata$Month,"1",sep="-")))

```


```{r}
td$Q1<-convert.scale(0.8,1,1-mydata$Bad/mydata$Total)
```

Второй показатель качества $Q_2$ находим как долю обращений без жалоб к общему числу обращений.
Идеальный показатель 1, минимально допустимый 0.99

```{r}
td$Q2<-convert.scale(0.99,1,1-mydata$Claim/mydata$Total)
```

Третий показатель качества $Q_3$ считаем как отклонение от максимально допустимого времени 7200 секунд (2 часа).  Идеальный показатель 7200, минимально допустимый 0.

```{r}
td$Q3<-convert.scale(0,7200,7200-mydata$Reg_time)
```
Четвертый показатель качества $Q_4$ считаем как отклонение от максимально допустимого времени в два дня 57600 секунд (16 часов).  Идеальный показатель 57600, минимально допустимый 0.

```{r}
td$Q4<-convert.scale(0,57600,57600-mydata$Work_Time)
```
Пятый показатель качества $Q_5$ --- средняя оценка. Идеальный 5, минимально допустимый 3.

```{r}
td$Q5<-convert.scale(3,5,mydata$Rate)
```
Результаты обработки данных

```{r pic1,warning=FALSE}
head(td)
summary(td)
plot(td$YM,td$Q1,xlab="Период",ylab="Показатель", type="l",main="Динамика показателей качества",ylim=c(0,1))
lines(td$YM,td$Q2,col="red")
lines(td$YM,td$Q3,col="green")
lines(td$YM,td$Q4,col="blue")
lines(td$YM,td$Q5,col="violet")
```

Расстановка приоритетов. Считаем наиболее важными оценки пользователей и долю жалоб.
На третьем месте учитываем нарушение установленных сроков.
P5>P1, P5>P2, P5>P3, P5>P4; P2>P1, P2>P3, P2>P4; P1>P3, P1>P4

Генерируем матрицу случайных элементов 1000x5 элементов с заданными ограничениями.

```{r}
mtx<-rpoly(1000, 5, data.frame(master=c(5,5,5,5,2,2,2,1,1),slave=c(1,2,3,4,1,3,4,3,4)))
summary(mtx)
saveRDS(mtx,file="mtx.RDS")

```

Рассчитаем целевые показатели 
```{r}
target<-c(convert.scale(0.8,1,0.95),
        convert.scale(0.99,1,0.995),
        convert.scale(0,7200,7200-5500),
        convert.scale(0,57600,57600-30000),
        convert.scale(3,5,3.4))
minimum<-c(convert.scale(0.8,1,0.91),
        convert.scale(0.99,1,0.99),
        convert.scale(0,7200,7200-7000),
        convert.scale(0,57600,57600-50000),
        convert.scale(3,5,3.2))

saveRDS(target,file="target.RDS")
saveRDS(minimum,file="minimum.RDS")
```

Проверим на доминирование каждый из показателей для каждого периода и рассчитаем вероятности

```{r}
td$minimum<-NA
td$target<-NA
for(i in 1:nrow(td)) {
td$target[i]<- sum(apply(mtx,1,FUN=function(x) { sum(x*td[i,2:6])>sum(x*target)}))/1000
td$minimum[i]<-sum(apply(mtx,1,FUN=function(x) { sum(x*td[i,2:6])>sum(x*minimum)}))/1000
}
saveRDS(td,file="table1.RDS")
```

Результирующий график

```{r pic2,warning=FALSE}
plot(td$YM,td$target,xlab="Период",ylab="Показатель", type="l",main="Динамика показателей качества",lwd=2)
```

Попробуем найти тренд

```{r}
x<-c(1:58)
summary(lm(td$target~x))
```

Зависимости от времени нет.

График комплексного показателя качества. Для этого возьмем коэффициенты:

```{r}
(k<-apply(mtx,2,mean))
sum(k)
```
и рассчитаем комплексный показатель качества и построим график
```{r pic3,warning=FALSE}
td$Q<-apply(td[,2:6],1,FUN=function(x){sum(x*k)})
plot(td$YM,td$Q,xlab="Период",ylab="Показатель", type="l",main="Динамика\n комплексного показателя качества",lwd=2)
```

Таким образом, методика оценки вероятности превышения случайного показателя над целевым более адекватно показывает текущую картину, чем обычная линейная свертка, даже с учетом рационально подобранных коэффициентов. 

Предложенная методика генерации матрицы случайных весов, методика робастного шкалирования, а также подхода к оцениванию комплексного показателя качества содержат определенную новацию и позволяют   решать широкий круг задач, связанный со сравнениями и оценками многопараметрических объектов в экономике и управлении.

Информация о параметрах R

```{r}
sessionInfo()
```










